<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPD Predict</title>
</head>

<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #f4f4f4;
  }
  
  form {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.1);
    max-width: 500px;
    width: 100%;
  }

  fieldset {
    margin-bottom: 20px;
  }

  legend {
    font-weight: bold;
    margin-bottom: 10px;
  }

  label {
    display: block;
    margin-bottom: 5px;
  }

  input[type="radio"] {
    margin-right: 5px;
  }

  #result-box {
    position: fixed;
    bottom: 20px;
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 4px;
    box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.1);
    text-align: center;
  }
</style>
</head>
<body>

<form action="/submit-form" method="post">
  <fieldset>
    <legend>Age</legend>
    <label><input type="radio" name="age" value="25-30"> 25-30</label><br>
    <label><input type="radio" name="age" value="30-35"> 30-35</label><br>
    <label><input type="radio" name="age" value="35-40"> 35-40</label><br>
    <label><input type="radio" name="age" value="40-45"> 40-45</label><br>
    <label><input type="radio" name="age" value="45-50"> 45-50</label><br>
  </fieldset>
  
  <fieldset>
    <legend>Sadness</legend>
    <label><input type="radio" name="sadness" value="Yes"> Yes</label><br>
    <label><input type="radio" name="sadness" value="Sometimes"> Sometimes</label><br>
    <label><input type="radio" name="sadness" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Dysphoria</legend>
    <label><input type="radio" name="dysphoria" value="Yes"> Yes</label><br>
    <label><input type="radio" name="dysphoria" value="Sometimes"> Sometimes</label><br>
    <label><input type="radio" name="dysphoria" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Insomnia</legend>
    <label><input type="radio" name="insomnia" value="Yes"> Yes</label><br>
    <label><input type="radio" name="insomnia" value="Two or more days a week"> Two or more days a week</label><br>
    <label><input type="radio" name="insomnia" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Cognitive Impairment</legend>
    <label><input type="radio" name="cognitive_impairment" value="Yes"> Yes</label><br>
    <label><input type="radio" name="cognitive_impairment" value="Often"> Often</label><br>
    <label><input type="radio" name="cognitive_impairment" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Anorexia</legend>
    <label><input type="radio" name="anorexia" value="Yes"> Yes</label><br>
    <label><input type="radio" name="anorexia" value="No"> No</label><br>
    <label><input type="radio" name="anorexia" value="Not at all"> Not at all</label><br>
  </fieldset>

  <fieldset>
    <legend>Guilt Complex</legend>
    <label><input type="radio" name="guilt_complex" value="Yes"> Yes</label><br>
    <label><input type="radio" name="guilt_complex" value="Maybe"> Maybe</label><br>
    <label><input type="radio" name="guilt_complex" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Attachment Disorder</legend>
    <label><input type="radio" name="attachment_disorder" value="Yes"> Yes</label><br>
    <label><input type="radio" name="attachment_disorder" value="Sometimes"> Sometimes</label><br>
    <label><input type="radio" name="attachment_disorder" value="No"> No</label><br>
  </fieldset>

  <fieldset>
    <legend>Suicidal Tendency</legend>
    <label><input type="radio" name="suicidal_tendency" value="Yes"> Yes</label><br>
    <label><input type="radio" name="suicidal_tendency" value="Not interested to say"> Not interested to say</label><br>
    <label><input type="radio" name="suicidal_tendency" value="No"> No</label><br>
  </fieldset>
</form>

<div id="result-box"></div>

<script>
    function ReLU(x) {
      return Math.max(0, x);
    }
    function vectorReLU(vect) {
      let row_arr = transpose(vect);
      row_arr[0] = row_arr[0].map((x) => Math.max(0, x));
      return transpose(row_arr);
    }
    function softMax(vect) {
      let row_arr = transpose(vect);
      let expsum = 0;
      for(e of row_arr[0]) expsum += Math.exp(e);
      row_arr[0] = row_arr[0].map((x) => Math.exp(x)/expsum);
      return transpose(row_arr);
    }
    function argMax(vect) {
      let row_arr = transpose(vect);
      let maxIndex = row_arr[0].indexOf(Math.max(...row_arr[0]));
      let new_vect = Array(row_arr[0].length).fill(0);
      new_vect[maxIndex] = 1;
      return transpose([new_vect]);
    }


    // MATRIX OPERATIONS _____________________________________________________________________

    function multiply_matrices(matrix_1, matrix_2) {
      if (matrix_1[0].length !== matrix_2.length) {
        throw new Error("Invalid dimensions for matrix multiplication.");
      }
      const product_matrix = [];
      for (let i = 0; i < matrix_1.length; i++) {
        product_matrix.push(new Array(matrix_2[0].length).fill(0));
      }
      for (let i = 0; i < matrix_1.length; i++) {
        for (let j = 0; j < matrix_2[0].length; j++) {
          for (let k = 0; k < matrix_1[0].length; k++) {
            product_matrix[i][j] += matrix_1[i][k] * matrix_2[k][j];
          }
        }
      }
      return product_matrix;
    }

    function add_matrices(matrix_1, matrix_2) {
      if (
        matrix_1[0].length !== matrix_2[0].length ||
        matrix_1.length !== matrix_2.length
      ) {
        throw new Error("Invalid dimensions for matrix addition.");
      }
      const add_matrix = [];
      for (let i in matrix_1) {
        add_matrix.push([]);
        for (let j in matrix_1[i]) {
          add_matrix[i][j] = matrix_1[i][j] + matrix_2[i][j];
        }
      }
      return add_matrix;
    }

    function transpose(matrix) {
      const transpose = [];
      for (let i = 0; i < matrix[0].length; i++) {
        transpose.push(new Array(matrix.length).fill(0));
      }
      for (let i = 0; i < matrix.length; i++) {
        for (let j = 0; j < matrix[0].length; j++) {
          transpose[j][i] = matrix[i][j];
        }
      }
      return transpose;
    }


    let weights = [
[[0.3690122067928314, -0.41090476512908936, -0.3364029824733734, 0.06629036366939545, 0.07137642055749893, 0.16006913781166077, -0.8207293748855591, -0.4710538685321808], [0.03473544120788574, -0.2558441460132599, 0.45630308985710144, -0.5558891892433167, 0.18697480857372284, 0.16000178456306458, 0.17896461486816406, 0.09567716717720032], [-0.17588241398334503, 1.0916829109191895, -0.3171953856945038, -0.5455844402313232, 0.14772778749465942, 0.8169323801994324, 0.044309355318546295, 0.3612385094165802], [0.48422175645828247, -0.0970136970281601, 0.20818132162094116, 0.1141812652349472, 0.24741874635219574, 0.06427595019340515, -0.43843191862106323, -0.5486526489257812], [0.6723694801330566, 0.08971204608678818, -0.21555067598819733, -0.2229076474905014, 0.36725175380706787, 0.6094207167625427, 0.2000967562198639, 0.6018264889717102], [0.250990092754364, -0.33934468030929565, 0.7843489646911621, -0.4946689307689667, 0.07204569876194, -0.04805383458733559, 0.19151340425014496, 0.036325689405202866], [-0.40364786982536316, 0.6834310293197632, -0.4170256555080414, -0.5148582458496094, 0.7673919200897217, -0.7492308616638184, -0.37838658690452576, 0.5502182245254517], [-0.018063455820083618, 0.6455897092819214, 0.16606871783733368, -0.1796073615550995, -0.43735644221305847, -0.19578449428081512, 0.6255166530609131, 0.14908583462238312], [-0.7204286456108093, -0.10461436212062836, -0.4114392101764679, -0.23118454217910767, -0.17937330901622772, 0.29220741987228394, 0.433336466550827, 0.3994673192501068]],
[[0.3370959162712097, -0.1469590812921524, -0.05258447676897049, 0.3849579989910126, 0.528239905834198, -0.5474339127540588, -0.9119676351547241, 0.6038781404495239], [0.5764276385307312, 0.06641269475221634, 0.11860442906618118, 0.7391551733016968, -0.6124044060707092, -0.06480720639228821, 0.34231603145599365, -0.21055950224399567], [0.31868574023246765, -0.36236539483070374, -0.7750235199928284, 0.20203472673892975, 0.32402804493904114, 0.6898415684700012, 0.06187429651618004, 0.9282516837120056], [-0.2611711323261261, -0.30830031633377075, -0.27173423767089844, -0.47017619013786316, -0.09737503528594971, 0.4393600821495056, -0.33723947405815125, -0.31027722358703613], [0.14572128653526306, 0.11278384178876877, -0.49604663252830505, -0.6071058511734009, -0.40822717547416687, -0.10514586418867111, -0.39535239338874817, -0.020936675369739532], [-0.033250413835048676, 0.3771239221096039, 0.6489845514297485, 0.15244537591934204, -0.6630476117134094, -1.4485163688659668, -0.5145875811576843, -0.11729449033737183], [-0.4196499288082123, 0.5255141258239746, 0.43195074796676636, 0.26228955388069153, 0.3839542865753174, 0.5292051434516907, 0.3052612543106079, -0.04214876517653465], [0.514009952545166, 0.2549828588962555, -0.441802442073822, -0.33055636286735535, -0.10736652463674545, -0.3728536069393158, 0.19028691947460175, -0.7509185671806335]],
[[-0.34553834795951843, -0.56513512134552, 0.5442482829093933, -0.09093239903450012, 0.5786715149879456, -0.38315340876579285, -0.44054707884788513, 0.37742283940315247], [0.14360274374485016, -0.45149970054626465, -0.1517203003168106, 0.47210338711738586, -0.429580420255661, 0.185812309384346, 0.4710295796394348, -0.4131191670894623], [0.5788313746452332, 0.14650584757328033, 0.34677982330322266, -0.14249886572360992, -0.7194146513938904, 0.5667850971221924, 0.0663454681634903, -0.9044830799102783], [0.6919740438461304, 0.7046231627464294, -0.4407975375652313, 0.4373279809951782, -0.3903086483478546, 0.7274459600448608, 0.38235825300216675, -0.15894345939159393], [0.5860501527786255, -0.06768900901079178, 0.07532066851854324, 0.8041942715644836, -0.8762412667274475, 1.084470272064209, 0.009596929885447025, -0.06876631826162338], [0.6152425408363342, 0.4541926980018616, 0.26471102237701416, 0.09990017116069794, -1.0492641925811768, 0.7962132692337036, 0.691912829875946, -0.4429440498352051], [-0.13208207488059998, 1.109312891960144, -0.18040074408054352, -0.961609423160553, 0.704043984413147, -1.0640554428100586, 0.6189639568328857, 1.1078472137451172], [0.6998553276062012, 0.5619121193885803, 0.03882087767124176, 0.3800763189792633, 0.32735973596572876, 0.29344549775123596, -0.03213868662714958, 0.4829539656639099]],
[[0.42659682035446167, -0.2687729001045227, -0.3985462784767151, 0.40078112483024597, 0.37772607803344727, 0.17096355557441711, 0.36403515934944153, 0.3783484995365143], [-0.8709980845451355, 0.4901595711708069, 0.5072436928749084, 0.5817901492118835, -1.076010823249817, -0.02922436036169529, 0.714779794216156, -0.40097057819366455], [0.43282830715179443, 0.5283926725387573, -0.6119273900985718, 0.303698867559433, -0.5533883571624756, 0.1304941177368164, -0.5413352847099304, -0.2431151121854782], [-0.1695384383201599, -0.1968201845884323, -0.21548663079738617, 0.27362191677093506, -0.09238136559724808, 0.4327123463153839, -0.015680992975831032, 0.35100650787353516], [0.4392857849597931, -0.6815428137779236, 0.6221098303794861, -0.7254170179367065, 0.7284631729125977, -0.6718093752861023, -0.847945511341095, 0.735880434513092], [0.26113998889923096, 0.022988812997937202, 0.30793899297714233, 0.7007704973220825, 0.09704738110303879, 0.7176599502563477, -0.34314876794815063, 0.5106036067008972], [0.2029372602701187, -0.530694842338562, 1.0458961725234985, -0.04116823151707649, -0.29241418838500977, -0.6169512271881104, 0.26504722237586975, 0.1289760172367096], [0.7073746919631958, -0.2284194976091385, 0.31541064381599426, -0.8309048414230347, 1.2851494550704956, -0.6130507588386536, -0.8679531216621399, 0.29128751158714294]],
[[-0.17547529935836792, -0.06898508965969086, 0.5603747367858887, -0.5209407210350037, 0.2410840541124344, 0.7029550075531006, 0.6043551564216614, -0.5450515747070312], [-1.0641547441482544, 0.23512981832027435, -0.7514553070068359, 0.3013535737991333, 1.3123356103897095, 0.39520466327667236, -0.7138158679008484, 0.42460328340530396], [1.256569266319275, 0.2447577267885208, 0.3620046377182007, -0.4946344792842865, -0.8262536525726318, -0.7888298630714417, 0.06363003700971603, -0.501491904258728], [0.6571992039680481, 0.08254321664571762, -0.9551132321357727, 0.09419997781515121, -0.2775469422340393, 0.2335084229707718, -1.0794801712036133, 0.14624625444412231], [-1.3918728828430176, 0.6780787110328674, 0.3413696885108948, 0.3027968108654022, 0.7791411876678467, -0.27001678943634033, 0.3562968671321869, 0.6055164933204651], [0.21225246787071228, 0.09593174606561661, -0.9961047172546387, 0.2971762418746948, 0.5315091013908386, 0.7586138248443604, -1.1554197072982788, -0.16840234398841858], [0.9864272475242615, -0.592441737651825, -0.40531036257743835, -0.3938601613044739, -0.38726404309272766, -1.1032788753509521, 0.34701767563819885, 0.5553993582725525], [-0.3229001462459564, 0.46504685282707214, 0.01622867025434971, -0.35216042399406433, 0.5212721228599548, 0.136652410030365, 0.273442804813385, -0.5720853805541992]],
[[0.6858665347099304, -1.3358724117279053], [-0.7953937649726868, -0.3701160252094269], [1.139878273010254, -0.7965489625930786], [0.7030609250068665, -0.6883609890937805], [-0.47617578506469727, 0.09202650189399719], [-0.8185135722160339, 0.018756043165922165], [0.3574749231338501, -1.1780973672866821], [-0.6893279552459717, -0.018894076347351074]],
]

let biases = [
[[0.2763713300228119, 0.1945166289806366, 0.04374773055315018, -0.028566867113113403, -0.17445573210716248, 0.05285027623176575, 0.11612776666879654, -0.040699783712625504]],
[[0.054023321717977524, -0.0334622822701931, 0.19593210518360138, 0.06888298690319061, 0.22912968695163727, 0.05793127045035362, -0.0039969757199287415, 0.1706255078315735]],
[[0.32020628452301025, -0.1768108755350113, 0.32647478580474854, 0.026337677612900734, 0.14810717105865479, 0.41280126571655273, -0.16339175403118134, 0.09699138253927231]],
[[0.17062479257583618, 0.024366378784179688, -0.007241431623697281, 0.09605047851800919, 0.1685529351234436, 0.11892063170671463, 0.028059421107172966, -0.005273432470858097]],
[[0.12455298006534576, 0.11575162410736084, 0.22053563594818115, -0.07101744413375854, 0.13595838844776154, 0.20116150379180908, 0.09702491015195847, 0.0]],
[[-0.1382548063993454, 0.13825465738773346]],
]
  
  weights = weights.map(matrix => transpose(matrix));
  biases = biases.map(matrix => transpose(matrix));


    let layers = [weights[0][0].length, ...weights.map(matrix => matrix.length)];

    function neural_network(input, w, b) {
      let input_vector = transpose([input]);
      for (i = 0; i < layers.length - 2; i++) {
        input_vector = vectorReLU(
          add_matrices(multiply_matrices(w[i], input_vector), b[i])
        );
      }
      let output = add_matrices(multiply_matrices(w[layers.length - 2], input_vector), b[layers.length - 2]);
      return softMax(output);
    }






    function getCheckedIndex(name) {
      let all=document.querySelectorAll(`input[name="${name}"]`);
      for(let i=0;i<all.length;i++) if(all[i].value==document.querySelector(`input[name="${name}"]:checked`).value) return(i);
  } 


    function depress_prob(a, s, d, i, c, an, g, at, st) {
      return neural_network([a, s, d, i, c, an, g, at, st],weights,biases)[0][0];
    }

  document.body.addEventListener("click", function() {
    try {
      var age = getCheckedIndex('age');
      var sadness = getCheckedIndex('sadness');
      var dysphoria = getCheckedIndex('dysphoria');
      var insomnia = getCheckedIndex('insomnia');
      var cognitive_impairment = getCheckedIndex('cognitive_impairment');
      var anorexia = getCheckedIndex('anorexia');
      var guilt_complex = getCheckedIndex('guilt_complex');
      var attachment_disorder = getCheckedIndex('attachment_disorder');
      var suicidal_tendency = getCheckedIndex('suicidal_tendency');

      var result = depress_prob(age, sadness, dysphoria, insomnia, cognitive_impairment, anorexia, guilt_complex, attachment_disorder, suicidal_tendency);
      document.getElementById("result-box").innerHTML = "Depression Probability: " + result.toFixed(4);
    } catch (err) {
      document.getElementById("result-box").innerHTML = "...";
    }
  });


</script>
</body>
</html>
